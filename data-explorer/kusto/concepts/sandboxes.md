---
title: サンドボックス-Azure データエクスプローラー
description: この記事では、Azure データエクスプローラーのサンドボックスについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 5732d0fa9773d0c8fe5420026cb855d1040b8706
ms.sourcegitcommit: 42cc7d11f41a5bfa9e021764b044dcd68d99a258
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/05/2020
ms.locfileid: "93403767"
---
# <a name="sandboxes"></a>サンドボックス

Kusto のデータエンジンサービスでは、セキュリティで保護された分離が必要な特定のフローに対してサンドボックスを実行できます。
これらのフローの例は、 [Python プラグイン](../query/pythonplugin.md) または [R プラグイン](../query/rplugin.md)を使用して実行されるユーザー定義のスクリプトです。

これらのサンドボックスを実行するために、Kusto は、Microsoft の [Drawbridge](https://www.microsoft.com/research/project/drawbridge/) プロジェクトの進化したバージョンを使用します。 このソリューションは、マルチテナント環境でユーザー定義オブジェクトを実行するために、他の Microsoft サービスによって使用されます。

サンドボックスで実行されるフローは分離されません。 また、ローカル (データの近く) でもあります。 これは、リモート呼び出しに追加の待機時間が追加されないことを意味します。

## <a name="prerequisites"></a>前提条件

* データエンジンしないでは、 [ディスク暗号化](../../security.md#data-encryption) が有効になっています。
  * 2つの機能の同時実行は、今後もサポートされる予定です。
* サンドボックスを実行するために必要なパッケージ (イメージ) は、各データエンジンのノードに展開され、実行には専用の SSD 領域が必要です。
  * 推定サイズは 20 GB で、D14_v2 VM の SSD 容量の約2.5% です。たとえば、L16_v1 VM の SSD 容量は0.7% です。
  * これはクラスターのデータ容量に影響し、クラスターの [コスト](https://azure.microsoft.com/pricing/details/data-explorer) に影響を与える可能性があります。

## <a name="runtime"></a>ランタイム

* サンドボックスクエリ演算子は、1つまたは複数のサンドボックスを実行に使用できます。
  * サンドボックスは1回の実行にのみ使用され、複数の実行間で共有されることはなく、実行が完了すると破棄されます。
  * サンドボックスはノードで遅延初期化されます。最初にクエリを実行するときにサンドボックスが必要になります。
    * つまり、ノードでサンドボックスを使用するプラグインの最初の実行には、短いウォームアップ期間が含まれます。
  * たとえば、サービスのアップグレードの一部としてノードを再起動すると、そのノード上で実行されているすべてのサンドボックスが破棄されます。
* 各ノードは、事前に定義された数のサンドボックスを保持し、受信した要求を実行する準備ができています。
  * サンドボックスを使用すると、新しいサンドボックスを自動的に置き換えることができます。
* クエリ演算子の提供に使用できる事前割り当て済みのサンドボックスがない場合は、新しいサンドボックスが使用可能になるまで調整されます。 詳細については、「 [エラー](#errors)」を参照してください。 新しいサンドボックス割り当ては、データノードの SKU と使用可能なリソースによっては、サンドボックスあたり最大10-15 秒かかることがあります。

## <a name="limitations"></a>制限事項

制限事項のいくつかは、各種類のサンドボックスについて、クラスターレベルの [サンドボックスポリシー](../management/sandboxpolicy.md)を使用して制御できます。

* **ノードあたりのサンド** ボックス数:ノードごとのサンドボックスの数は制限されています。
  * 使用可能なサンドボックスがないときに行われた要求は調整されます。
* **ネットワーク:** サンドボックスは、仮想マシン (VM) 上またはその外部のリソースと対話することはできません。
  * サンドボックスは、別のサンドボックスと対話することはできません。
* **CPU:** サンドボックスがホストのプロセッサを使用できる最大 CPU 速度は制限されています (既定値は `50%` )。
  * 制限に達すると、サンドボックスの CPU 使用は調整されますが、実行は続行されます。
* **メモリ:** サンドボックスがホストの RAM を消費できる最大 RAM 容量は制限されています (既定値は `20GB` )。
  * 制限に達すると、サンドボックスが終了し、クエリの実行エラーが発生します。
* **ディスク:** サンドボックスには、一意の独立したディレクトリがアタッチされています。 ホストのファイルシステムにアクセスできません。
  * 一意のフォルダーは、サンドボックスの種類に一致するイメージまたはパッケージへのアクセスを提供します。 たとえば、カスタマイズできない Python または R パッケージなどです。
* **子プロセス:** サンドボックスは、子プロセスを開始できません。

> [!NOTE]
> サンドボックスで使用されるリソースは、要求の一部として処理されるデータのサイズだけでなく、サンドボックスで実行されるロジックや、それによって使用されているライブラリの実装にも依存します。
> たとえば、 `python` プラグインとプラグインの場合、 `r` 後者はユーザー指定のスクリプトと、実行時に使用する Python または R ライブラリを意味します。

## <a name="errors"></a>エラー

|ErrorCode                 |Status                     |Message                                                                                            |考えられる理由                                                                                                    |
|--------------------------|---------------------------|---------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|TooManyRequests (429)      |サンドボックス化されたクエリは、調整によって中止されました。 バックオフが正常に完了した後に再試行する   |ターゲットノードに使用可能なサンドボックスがありません。 新しいサンドボックスは数秒で利用可能になります         |
|E_SB_QUERY_THROTTLED_ERROR|TooManyRequests (429)      |種類 ' {kind} ' のサンドボックスはまだ初期化されていません                                            |サンドボックスポリシーは最近変更されました。 新しいサンドボックス obeying 新しいポリシーが数秒で利用可能になります|
|                          |InternalServiceError (520) |サンドボックスの初期化でエラーが発生したため、サンドボックス化されたクエリが中止されました                         |予期しないインフラストラクチャエラーです。                         |
