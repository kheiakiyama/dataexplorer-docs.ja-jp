---
title: funnel_sequence プラグイン-Azure データエクスプローラー
description: この記事では、Azure データエクスプローラーの funnel_sequence プラグインについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: alexans
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
ms.openlocfilehash: 34159fb6d02cd30907924109c861d5e9fd963568
ms.sourcegitcommit: 608539af6ab511aa11d82c17b782641340fc8974
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/20/2020
ms.locfileid: "92252332"
---
# <a name="funnel_sequence-plugin"></a>funnel_sequence プラグイン

一連の状態を取得したユーザーの個別のカウント、およびそのシーケンスの前後にある、前後の状態の分布を計算します。 

```kusto
T | evaluate funnel_sequence(id, datetime_column, startofday(ago(30d)), startofday(now()), 10m, 1d, state_column, dynamic(['S1', 'S2', 'S3']))
```

## <a name="syntax"></a>構文

*T* `| evaluate` `funnel_sequence(` *idcolumn* `,` *TimelineColumn* `,` *Start* `,` *End* `,` *maxsequencestepwindow*、 *Step*、 *statecolumn*、 *Sequence*`)`

## <a name="arguments"></a>引数

* *T*: 入力テーブル式。
* *Idcolum*: 列参照。ソース式に存在する必要があります。
* *TimelineColumn*: タイムラインを表す列参照は、ソース式に存在する必要があります。
* *Start*: 分析の開始期間のスカラー定数値。
* *End*: 分析終了期間のスカラー定数値。
* *Maxsequencestepwindow*: シーケンス内の2つの連続するステップ間で許容される最大 timespan のスカラー定数値。
* *ステップ*: 分析ステップ期間 (bin) のスカラー定数値。
* *Statecolumn*: 状態を表す列参照は、ソース式に存在する必要があります。
* *Sequence*: シーケンス値を持つ定数動的配列 (値はで検索され `StateColumn` ます)。

## <a name="returns"></a>戻り値

は、次の3つの出力テーブルを返します。これは、分析されたシーケンスの sankey ダイアグラムを構築するのに役立ちます。

* テーブル #1-TimelineColumn-next: [前の `dcount` 分析された時間枠]: 前の状態 (検索シーケンスのイベントのみを持ち、それより前のイベントは存在しないユーザーが存在する場合は、空の可能性があります)。 
    次: 次の状態 (検索されたシーケンスのイベントしかないユーザーがいても、その後に続くイベントは存在しない場合は、空の可能性があります)。 
    `dcount`: `IdColumn` 遷移した時間枠の個別のカウント `prev`  -->  `Sequence`  -->  `next` 。 
    サンプル: 行のシーケンスに対応する (からの) Id の配列 `IdColumn` (最大128の id が返されます)。 

* テーブル #2-TimelineColumn: 前の分析された `dcount` 時間枠 (前の状態): 前の状態 (検索シーケンスのイベントのみを持ち、それより前のイベントではないユーザーが存在する場合は、空の場合があります)。 
    `dcount`: `IdColumn` 遷移した時間枠の個別のカウント `prev`  -->  `Sequence`  -->  `next` 。 
    サンプル: 行のシーケンスに対応する (からの) Id の配列 `IdColumn` (最大128の id が返されます)。 

* テーブル #3-sequence-next `dcount` TimelineColumn: 分析された時間枠次: 次の状態になります (検索されたシーケンスのイベントしかないユーザーがいても、その後に続くイベントは存在しない場合は空の場合があります)。 
    `dcount`: `IdColumn` 遷移した時間枠の個別のカウント `prev`  -->  `Sequence`  -->  `next` 。
    サンプル: 行のシーケンスに対応する (からの) Id の配列 `IdColumn` (最大128の id が返されます)。 


## <a name="examples"></a>例

### <a name="exploring-storm-events"></a>ストームイベントの調査 

次のクエリでは、テーブル StormEvents (2007 の weather 統計) を参照し、2007ですべての Tornado イベントが発生する前後にどのイベントが発生したかを示します。

<!-- csl: https://help.kusto.windows.net:443/Samples -->
```kusto
// Looking on StormEvents statistics: 
// Q1: What happens before Tornado event?
// Q2: What happens after Tornado event?
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, dynamic(['Tornado']))
```

結果には次の3つのテーブルが含まれます。

* テーブル #1: シーケンスの前後で発生する可能性のあるすべてのバリエーション。 たとえば、2行目は、次のシーケンスを持つ87の異なるイベントがあったことを意味します。 `Hail` -> `Tornado` -> `Hail`


|`StartTime`|`prev`|`next`|`dcount`|
|---|---|---|---|
|2007-01-01 00:00: 00.0000000|||293|
|2007-01-01 00:00: 00.0000000|ひょう|ひょう|87|
|2007-01-01 00:00: 00.0000000|雷雨風|雷雨風|77|
|2007-01-01 00:00: 00.0000000|ひょう|雷雨風|28|
|2007-01-01 00:00: 00.0000000|ひょう||28|
|2007-01-01 00:00: 00.0000000||ひょう|27|
|2007-01-01 00:00: 00.0000000||雷雨風|25|
|2007-01-01 00:00: 00.0000000|雷雨風|ひょう|24|
|2007-01-01 00:00: 00.0000000|雷雨風||24|
|2007-01-01 00:00: 00.0000000|鉄砲水|鉄砲水|12|
|2007-01-01 00:00: 00.0000000|雷雨風|鉄砲水|8|
|2007-01-01 00:00: 00.0000000|鉄砲水||8|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|雷雨風|6|
|2007-01-01 00:00: 00.0000000||じょうごクラウド|6|
|2007-01-01 00:00: 00.0000000||鉄砲水|6|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|じょうごクラウド|6|
|2007-01-01 00:00: 00.0000000|ひょう|鉄砲水|4|
|2007-01-01 00:00: 00.0000000|鉄砲水|雷雨風|4|
|2007-01-01 00:00: 00.0000000|ひょう|じょうごクラウド|4|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|ひょう|4|
|2007-01-01 00:00: 00.0000000|じょうごクラウド||4|
|2007-01-01 00:00: 00.0000000|雷雨風|じょうごクラウド|3|
|2007-01-01 00:00: 00.0000000|重い雨|雷雨風|2|
|2007-01-01 00:00: 00.0000000|鉄砲水|じょうごクラウド|2|
|2007-01-01 00:00: 00.0000000|鉄砲水|ひょう|2|
|2007-01-01 00:00: 00.0000000|強風|雷雨風|1|
|2007-01-01 00:00: 00.0000000|重い雨|鉄砲水|1|
|2007-01-01 00:00: 00.0000000|重い雨|ひょう|1|
|2007-01-01 00:00: 00.0000000|ひょう|洪水|1|
|2007-01-01 00:00: 00.0000000|ライトニング|ひょう|1|
|2007-01-01 00:00: 00.0000000|重い雨|ライトニング|1|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|重い雨|1|
|2007-01-01 00:00: 00.0000000|鉄砲水|洪水|1|
|2007-01-01 00:00: 00.0000000|洪水|鉄砲水|1|
|2007-01-01 00:00: 00.0000000||重い雨|1|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|ライトニング|1|
|2007-01-01 00:00: 00.0000000|ライトニング|雷雨風|1|
|2007-01-01 00:00: 00.0000000|洪水|雷雨風|1|
|2007-01-01 00:00: 00.0000000|ひょう|ライトニング|1|
|2007-01-01 00:00: 00.0000000||ライトニング|1|
|2007-01-01 00:00: 00.0000000|熱帯嵐|ハリケーン (台風)|1|
|2007-01-01 00:00: 00.0000000|Coastal フラッド||1|
|2007-01-01 00:00: 00.0000000|現在の取り込み||1|
|2007-01-01 00:00: 00.0000000|重い雪||1|
|2007-01-01 00:00: 00.0000000|強風||1|

* テーブル #2: 前のイベントによってグループ化されたすべての個別のイベントを表示します。 たとえば、2行目は、その直前に発生したの合計150イベントがあることを示して `Hail` `Tornado` います。

|`StartTime`|`prev`|`dcount`|
|---------|-----|------|
|2007-01-01 00:00: 00.0000000||331|
|2007-01-01 00:00: 00.0000000|ひょう|150|
|2007-01-01 00:00: 00.0000000|雷雨風|135|
|2007-01-01 00:00: 00.0000000|鉄砲水|28|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|22|
|2007-01-01 00:00: 00.0000000|重い雨|5|
|2007-01-01 00:00: 00.0000000|洪水|2|
|2007-01-01 00:00: 00.0000000|ライトニング|2|
|2007-01-01 00:00: 00.0000000|強風|2|
|2007-01-01 00:00: 00.0000000|重い雪|1|
|2007-01-01 00:00: 00.0000000|現在の取り込み|1|
|2007-01-01 00:00: 00.0000000|Coastal フラッド|1|
|2007-01-01 00:00: 00.0000000|熱帯嵐|1|

* テーブル #3: 次のイベント別にグループ化されたすべての個別のイベントを表示します。 たとえば、2行目は、の後に発生したの合計143イベントがあることを示して `Hail` `Tornado` います。

|`StartTime`|`next`|`dcount`|
|---------|-----|------|
|2007-01-01 00:00: 00.0000000||332|
|2007-01-01 00:00: 00.0000000|ひょう|145|
|2007-01-01 00:00: 00.0000000|雷雨風|143|
|2007-01-01 00:00: 00.0000000|鉄砲水|32|
|2007-01-01 00:00: 00.0000000|じょうごクラウド|21|
|2007-01-01 00:00: 00.0000000|ライトニング|4|
|2007-01-01 00:00: 00.0000000|重い雨|2|
|2007-01-01 00:00: 00.0000000|洪水|2|
|2007-01-01 00:00: 00.0000000|ハリケーン (台風)|1|

では、次のシーケンスの動作を確認してみましょう。  
`Hail` -> `Tornado` -> `Thunderstorm Wind`

<!-- csl: https://help.kusto.windows.net:443/Samples -->
```kusto
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, 
dynamic(['Hail', 'Tornado', 'Thunderstorm Wind']))
```

をスキップし、を確認すると、 `Table #1` `Table #2` `Table #3` `Hail`  ->  `Tornado`  ->  `Thunderstorm Wind` 92 イベントのシーケンスがこのシーケンスで終了し、41イベントとして続行さ `Hail` れ、14に戻されることになり `Tornado` ます。

|`StartTime`|`next`|`dcount`|
|---------|-----|------|
|2007-01-01 00:00: 00.0000000||92|
|2007-01-01 00:00: 00.0000000|ひょう|41|
|2007-01-01 00:00: 00.0000000|Tornado|14|
|2007-01-01 00:00: 00.0000000|鉄砲水|11|
|2007-01-01 00:00: 00.0000000|ライトニング|2|
|2007-01-01 00:00: 00.0000000|重い雨|1|
|2007-01-01 00:00: 00.0000000|洪水|1|
